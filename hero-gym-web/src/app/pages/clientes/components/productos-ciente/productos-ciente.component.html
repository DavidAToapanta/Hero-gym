<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-100">
      <div>
        <h2 class="text-xl font-bold text-gray-900">Productos</h2>
        <p class="text-sm text-gray-500">
          Cliente: {{ cliente?.usuario?.nombres }} {{ cliente?.usuario?.apellidos }}
        </p>
      </div>
      <button (click)="cerrar()" class="text-gray-400 hover:text-gray-600 transition">
        <lucide-icon name="x" class="w-6 h-6"></lucide-icon>
      </button>
    </div>

    <!-- Content -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Product List (Left) -->
      <div class="w-2/3 p-6 overflow-y-auto border-r border-gray-100">
        <div class="mb-4">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="loadProductos()"
            placeholder="Buscar productos..."
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            />
          </div>

          <div class="grid grid-cols-2 gap-4">
            @for (p of productos; track p) {
              <div class="border rounded-xl p-4 hover:shadow-md transition flex flex-col justify-between">
                <div>
                  <h4 class="font-semibold text-gray-800">{{ p.nombre }}</h4>
                  <p class="text-sm text-gray-500">Stock: {{ p.stock }}</p>
                </div>
                <div class="flex items-center justify-between mt-4">
                  <span class="font-bold text-indigo-600">${{ p.precio | number:'1.2-2' }}</span>
                  <button
                    (click)="addToCart(p)"
                    [disabled]="p.stock === 0"
                    class="bg-indigo-50 text-indigo-600 p-2 rounded-lg hover:bg-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                    <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
                  </button>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Cart (Right) -->
        <div class="w-1/3 p-6 flex flex-col bg-gray-50">
          <h3 class="font-semibold text-gray-900 mb-4">Carrito de Compra</h3>

          <div class="flex-1 overflow-y-auto space-y-3">
            @for (item of cart; track item) {
              <div class="bg-white p-3 rounded-lg shadow-sm flex items-center justify-between">
                <div class="flex-1">
                  <p class="font-medium text-sm text-gray-800">{{ item.nombre }}</p>
                  <p class="text-xs text-gray-500">${{ item.precio }} x {{ item.cantidad }}</p>
                </div>
                <div class="flex items-center gap-2">
                  <button (click)="updateQuantity(item, -1)" class="text-gray-400 hover:text-gray-600">
                    <lucide-icon name="minus-circle" class="w-4 h-4"></lucide-icon>
                  </button>
                  <span class="text-sm font-medium w-4 text-center">{{ item.cantidad }}</span>
                  <button (click)="updateQuantity(item, 1)" class="text-gray-400 hover:text-gray-600">
                    <lucide-icon name="plus-circle" class="w-4 h-4"></lucide-icon>
                  </button>
                  <button (click)="removeFromCart(item.id)" class="text-red-400 hover:text-red-600 ml-1">
                    <lucide-icon name="trash-2" class="w-4 h-4"></lucide-icon>
                  </button>
                </div>
              </div>
            }

            @if (cart.length === 0) {
              <div class="text-center py-8 text-gray-400 text-sm">
                El carrito está vacío
              </div>
            }
          </div>

          <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="flex justify-between items-center mb-4">
              <span class="font-semibold text-gray-700">Total</span>
              <span class="text-xl font-bold text-indigo-600">${{ total | number:'1.2-2' }}</span>
            </div>

            @if (!purchaseSuccess) {
              <button
                (click)="comprar()"
                [disabled]="cart.length === 0"
                class="w-full bg-indigo-600 text-white py-3 rounded-xl font-medium hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                Confirmar Compra
              </button>
            }

            @if (purchaseSuccess) {
              <div class="space-y-2">
                <div class="bg-green-100 text-green-700 p-3 rounded-lg text-center text-sm font-medium">
                  ¡Compra realizada con éxito!
                </div>
                <button
                  (click)="imprimirTicket()"
                  class="w-full bg-gray-800 text-white py-3 rounded-xl font-medium hover:bg-gray-900 transition flex items-center justify-center gap-2"
                  >
                  <lucide-icon name="printer" class="w-4 h-4"></lucide-icon>
                  Imprimir Ticket
                </button>
                <button
                  (click)="purchaseSuccess = false; lastPurchase = null"
                  class="w-full text-indigo-600 text-sm font-medium hover:underline text-center"
                  >
                  Nueva Compra
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
