<!-- Fondo oscuro -->
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
  <!-- Modal -->
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 relative">
    <!-- Botón cerrar -->
    <button
      type="button"
      (click)="cerrar()"
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl"
      aria-label="Cerrar"
    >
      ×
    </button>

    <h2 class="text-2xl font-semibold text-gray-900 mb-6">
      Registrar Pago
    </h2>

    <!-- Error -->
    <div *ngIf="errorMessage" class="mb-3 p-3 rounded bg-red-50 text-red-700 text-sm">
      {{ errorMessage }}
    </div>

    <!-- Formulario -->
    <form #pagoForm="ngForm" (ngSubmit)="guardar()" class="space-y-5">
      <!-- Cliente -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
        <select
          name="clienteId"
          required
          [(ngModel)]="selectedClienteId"
          (ngModelChange)="onClienteChange()"
          class="w-full border border-gray-200 rounded-xl px-4 py-2.5 text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
        >
          <option [ngValue]="null" disabled>Seleccionar cliente...</option>
          <option *ngFor="let c of clientes" [ngValue]="c.id">{{ c.nombre }}</option>
        </select>
      </div>

      <!-- Plan -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Plan</label>
        <select
          name="planId"
          required
          [disabled]="!selectedClienteId || !planes?.length"
          [(ngModel)]="selectedPlanId"
          (ngModelChange)="onPlanChange()"
          class="w-full border border-gray-200 rounded-xl px-4 py-2.5 text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none disabled:bg-gray-100"
        >
          <option [ngValue]="null" disabled>Seleccionar plan...</option>
          <option *ngFor="let p of planes" [ngValue]="p.id">
            {{ p?.nombre }} ({{ p?.mesesPagar }} mes(es))
          </option>
        </select>
      </div>

      <!-- Detalles del Plan -->
      <div *ngIf="detallesPlan" class="rounded-xl border border-gray-200 p-4 bg-gray-50">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm text-gray-500">Plan</div>
            <div class="font-medium text-gray-900">{{ detallesPlan?.nombre }}</div>
          </div>
          <div>
            <span
              class="text-xs px-2 py-1 rounded-full"
              [ngClass]="detallesPlan?.activado ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
            >
              {{ detallesPlan?.activado ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
        </div>
        <div class="mt-3 grid grid-cols-2 gap-4 text-sm">
          <div>
            <div class="text-gray-500">Inicio</div>
            <div class="text-gray-900">{{ detallesPlan?.fechaInicio | date:'yyyy-MM-dd' }}</div>
          </div>
          <div>
            <div class="text-gray-500">Fin</div>
            <div class="text-gray-900">{{ detallesPlan?.fechaFin | date:'yyyy-MM-dd' }}</div>
          </div>
        </div>
        <div *ngIf="detallesPlan?.precio !== undefined" class="mt-3 text-sm text-gray-700">
          Precio del plan: <span class="font-medium">{{ detallesPlan?.precio }}</span>
        </div>
      </div>

      <!-- Monto -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Monto</label>
        <input
          name="monto"
          type="number"
          step="0.01"
          required
          [(ngModel)]="pago.monto"
          class="w-full border border-gray-200 rounded-xl px-4 py-2.5 text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
        />
        <div class="mt-1 text-xs text-gray-500">Se autocompleta con el precio del plan, pero puedes ajustarlo.</div>
      </div>

      <!-- Fecha de Pago -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de pago</label>
        <input
          name="fecha"
          type="date"
          required
          [(ngModel)]="pago.fecha"
          class="w-full border border-gray-200 rounded-xl px-4 py-2.5 text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
        />
      </div>

      <!-- Botones -->
      <div class="flex justify-end space-x-3 pt-4">
        <button
          type="button"
          (click)="cerrar()"
          class="px-4 py-2.5 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition"
        >
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="isSubmitting || !pagoForm.form.valid"
          class="px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition disabled:opacity-60"
        >
          {{ isSubmitting ? 'Guardando...' : 'Registrar' }}
        </button>
      </div>
    </form>
  </div>
</div>
